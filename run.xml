<?xml version="1.0" encoding="UTF-8"?>
<project name="semver" default="semver">

    <!--
    args:
      version.file: VERSION
      version.number: 3.0.0
    -->
    <target name="semver">

        <property name="scm.type" value="git" />

        <property name="version.file" value="${ws.dir}/VERSION" />
        <property name="version.number" value=""/>

        <var name="##version.number##" value="${version.number}"/>

        <if>
            <equals arg1="${##version.number##}" arg2="" trim="true" />
            <then>
                <if>
                    <equals arg1="${scm.type}" arg2="svn" trim="true" />
                    <then>
                        <echo message="--// get svn revision..." />
                        <get-svn-info targetFile="${ws.dir}" svnRevisionProperty="artifact.svn.revision" svnUrlProperty="artifact.svn.url" />
                        <var name="##version.number##" value="${artifact.svn.revision}.1" />
                        <echo message="--// svn.revsion: ${##version.number##}" />
                    </then>
                    <elseif>
                        <equals arg1="${scm.type}" arg2="git" trim="true" />
                        <then>
                            <echo message="${ws.dir}" />
                            <get-git-commit-id repoDir="${ws.dir}" />
                            <var name="##version.number##" value="${git.commit.id}.1" />
                            <echo message="--// git.commit.id: ${##version.number##}" />
                        </then>
                    </elseif>
                    <else>
                        <fail message="--// scm.type: ${scm.type} is not supported." />
                    </else>
                </if>
                <if>
                    <available file="${version.file}" />
                    <then>
                        <loadfile property="production.version" srcFile="${version.file}" failonerror="true" />
                        <echo message="${production.version}+${##version.number##}" file="${version.file}"/>
                    </then>
                    <else>
                        <echo message="1.0.0+${##version.number##}" file="${version.file}"/>
                    </else>
                </if>
            </then>
            <else>
                <echo message="${##version.number##}" file="${version.file}"/>
            </else>
        </if>

    </target>

</project>
